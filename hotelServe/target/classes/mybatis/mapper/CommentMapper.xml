<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.CommentMapper">



    <resultMap id="BaseResultMap" type="com.example.demo.entity.CommentEntity">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="comment_id" jdbcType="INTEGER" property="comment_id" />
        <id column="hotel_id" jdbcType="INTEGER" property="hotel_id" />
        <id column="user_id" jdbcType="INTEGER" property="user_id" />
        <result column="content" jdbcType="VARCHAR" property="content" />
        <result column="addtime" jdbcType="TIMESTAMP" property="addtime" />
        <result column="grade" jdbcType="INTEGER" property="grade" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="account" jdbcType="VARCHAR" property="account" />
        <result column="img" jdbcType="VARCHAR" property="userImg" />


    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from comment
        where comment_id = #{comment_id,jdbcType=INTEGER}
    </delete>


    <insert id="insert" parameterType="com.example.demo.entity.CommentEntity">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="comment_id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into comment (hotel_id, user_id, `content`, `addtime`,
        grade)
        values (#{hotel_id,jdbcType=INTEGER}, #{user_id,jdbcType=INTEGER}, #{content,jdbcType=VARCHAR},
        #{addtime,jdbcType=TIMESTAMP},#{grade,jdbcType=INTEGER})
    </insert>

    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select *
        from comment
        where comment_id = #{comment_id,jdbcType=INTEGER}
    </select>
    <select id="selectAll" parameterType="java.lang.Integer" resultMap="BaseResultMap" useCache="true">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
     select *
      from comment, user1   where  comment.hotel_id =#{hotel_id}  and comment.user_id = user1.account  order by addtime desc

    </select>

    <select id="avgGrade" parameterType="java.lang.Integer" resultType="java.lang.Integer" useCache="true">

        select AVG(grade) AS grade
        from comment  where  comment.hotel_id = #{hotel_id,jdbcType=INTEGER}
    </select>



</mapper>
